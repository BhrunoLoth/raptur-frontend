import{r,u as E,j as a}from"./index-B9Nf5u-5.js";import{P as w}from"./PublicLayout-CMtIB1BJ.js";import{l as C}from"./logo-raptur-BtDZxBYO.js";const h="https://api.seudominio.com/api";function P(){const[u,f]=r.useState(""),[m,b]=r.useState(""),[c,S]=r.useState(""),[d,s]=r.useState(""),[p,i]=r.useState(!1),j=E(),x=r.useRef(null),y=async o=>{var n,l;if(o.preventDefault(),s(""),!u.trim()||!m.trim()||!c.trim()){s("Preencha todos os campos.");return}if(!/\S+@\S+\.\S+/.test(u)){s("Digite um e-mail válido.");return}if(c.trim().length<2){s("Digite o ID do ônibus corretamente.");return}i(!0);try{localStorage.removeItem("token"),localStorage.removeItem("usuario"),localStorage.removeItem("onibusId");const t=await fetch(`${h}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,senha:m})}),e=await t.json();if(!t.ok){s((e==null?void 0:e.erro)||"Erro no login."),i(!1);return}const v=((n=e.usuario)==null?void 0:n.role)==="motorista"||((l=e.usuario)==null?void 0:l.perfil)==="motorista";if(e.token&&v){const N={...e.usuario,perfil:"motorista",nome:e.usuario.nome||"Motorista"};localStorage.setItem("token",e.token),localStorage.setItem("usuario",JSON.stringify(N)),localStorage.setItem("onibusId",c),await I(e.token),i(!1),j("/motorista/dashboard")}else s("Acesso negado: apenas motoristas."),i(!1)}catch(t){console.error("Erro no login:",t),s("Erro ao fazer login. Tente novamente."),i(!1)}},g=()=>d&&s(""),I=async o=>{try{const l=await(await fetch(`${h}/admin/usuarios`,{headers:{Authorization:`Bearer ${o}`}})).json();if(!Array.isArray(l))throw new Error("Resposta inesperada da API");const t=l.filter(e=>e.ativo&&e.qrCode&&e.perfil==="passageiro");localStorage.setItem("passageirosQR",JSON.stringify(t))}catch(n){console.error("❌ Erro ao sincronizar passageiros:",n)}};return a.jsx(w,{children:a.jsxs("div",{className:"dashboard-main-card login-card",children:[a.jsx("img",{src:C,alt:"Logo Raptur",width:110,style:{margin:"0 auto 10px auto",display:"block"}}),a.jsx("h2",{className:"user-title",style:{marginBottom:18},children:"Acesso Motorista"}),a.jsxs("form",{className:"login-form",onSubmit:y,autoComplete:"off",children:[a.jsx("label",{htmlFor:"email",className:"user-label",children:"Email"}),a.jsx("input",{id:"email",className:"user-input",placeholder:"Digite seu e-mail",value:u,onChange:o=>{f(o.target.value),g()},ref:x,autoFocus:!0,"aria-label":"Email",type:"email",autoComplete:"username"}),a.jsx("label",{htmlFor:"senha",className:"user-label",children:"Senha"}),a.jsx("input",{id:"senha",className:"user-input",placeholder:"Digite sua senha",value:m,onChange:o=>{b(o.target.value),g()},"aria-label":"Senha",type:"password",autoComplete:"current-password"}),a.jsx("label",{htmlFor:"onibusId",className:"user-label",children:"ID do Ônibus"}),a.jsx("input",{id:"onibusId",className:"user-input",placeholder:"Digite o ID do ônibus",value:c,onChange:o=>{S(o.target.value),g()},"aria-label":"Ônibus",type:"text"}),d&&a.jsx("div",{className:"user-error",children:d}),a.jsx("button",{type:"submit",className:"action-btn login-btn",disabled:p,children:p?"Entrando...":"Entrar"})]})]})})}export{P as default};
