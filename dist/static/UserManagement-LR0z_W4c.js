import{r as l,j as e}from"./index-B9Nf5u-5.js";import{E as D}from"./jspdf.plugin.autotable-Bn4SibeE.js";import{a as j}from"./api-DLJ_9syT.js";import"./index-ngrFHoWO.js";async function F(){return(await j.get("/usuarios")).data}async function G(s){return(await j.post("/usuarios",s)).data}async function q(s){await j.delete(`/usuarios/${s}`)}function A(s){const i=["Nome","Email","CPF","RG","Perfil"],t=s.map(a=>[a.nome,a.email,a.cpf,a.rg,a.perfil]),x="data:text/csv;charset=utf-8,"+i.join(",")+`
`+t.map(a=>a.join(",")).join(`
`),u=encodeURI(x),c=document.createElement("a");c.setAttribute("href",u),c.setAttribute("download","usuarios.csv"),document.body.appendChild(c),c.click(),document.body.removeChild(c)}function _(s){const i=new D;i.text("Usu√°rios Cadastrados",14,16),i.autoTable({startY:22,head:[["Nome","Email","CPF","RG","Perfil"]],body:s.map(t=>[t.nome,t.email,t.cpf,t.rg,t.perfil])}),i.save("usuarios.pdf")}const I=()=>{const[s,i]=l.useState([]),[t,x]=l.useState(""),[u,c]=l.useState(""),[a,b]=l.useState(""),[h,v]=l.useState(""),[m,N]=l.useState(""),[f,y]=l.useState(""),[C,o]=l.useState(""),w=l.useRef(null);l.useEffect(()=>{(async()=>{try{const n=await F();i(n)}catch(n){o("Erro ao carregar usu√°rios."),console.error(n)}})()},[]);const S=r=>/^\d{11}$/.test(r.replace(/\D/g,"")),E=async r=>{var p,g,P;if(r.preventDefault(),o(""),!t.trim()||!u.trim()||!a.trim()||!h.trim()||!m)return o("Preencha todos os campos obrigat√≥rios.");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u))return o("Digite um e-mail v√°lido.");if(!S(a))return o("CPF deve ter 11 d√≠gitos num√©ricos.");if(h.length<5)return o("Digite um RG v√°lido (m√≠nimo 5 caracteres).");if(s.some(d=>d.cpf===a))return o("J√° existe um usu√°rio cadastrado com esse CPF.");try{const d={nome:t,email:u,cpf:a.replace(/\D/g,""),rg:h,senha:"123456",perfil:m,precisaTrocarSenha:!0};if(m==="passageiro"&&(d.subtipo_passageiro=f,d.saldo_credito=0,!f))return o("Escolha o subtipo do passageiro.");const U=await G(d);i([...s,U]),x(""),c(""),b(""),v(""),N(""),y(""),(p=w.current)==null||p.focus()}catch(d){(P=(g=d.response)==null?void 0:g.data)!=null&&P.erro?o(d.response.data.erro):o("Erro ao criar usu√°rio.")}},R=async r=>{const n=s[r];if(window.confirm(`Remover ${n.nome}?`))try{await q(n.id),i(s.filter((p,g)=>g!==r))}catch(p){console.error(p),o("Erro ao remover usu√°rio.")}};return e.jsxs("div",{className:"p-4 max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-green-900",children:"üë§ Gerenciar Usu√°rios"}),e.jsxs("form",{onSubmit:E,className:"grid md:grid-cols-2 gap-4 mb-6 bg-white p-4 rounded shadow",autoComplete:"off",children:[e.jsx("input",{id:"nome",className:"border p-2 rounded",placeholder:"Nome",value:t,onChange:r=>x(r.target.value),ref:w,required:!0}),e.jsx("input",{id:"email",className:"border p-2 rounded",placeholder:"E-mail",value:u,onChange:r=>c(r.target.value),type:"email",required:!0}),e.jsx("input",{id:"cpf",className:"border p-2 rounded",placeholder:"CPF (somente n√∫meros)",value:a,onChange:r=>b(r.target.value.replace(/\D/g,"")),required:!0,maxLength:11,inputMode:"numeric",pattern:"[0-9]{11}"}),e.jsx("input",{id:"rg",className:"border p-2 rounded",placeholder:"RG",value:h,onChange:r=>v(r.target.value),required:!0}),e.jsxs("select",{id:"perfil",className:"border p-2 rounded",value:m,onChange:r=>N(r.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecione o Perfil"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"motorista",children:"Motorista"}),e.jsx("option",{value:"passageiro",children:"Passageiro"})]}),m==="passageiro"&&e.jsxs("select",{id:"subtipo",className:"border p-2 rounded",value:f,onChange:r=>y(r.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Subtipo Passageiro"}),e.jsx("option",{value:"aluno_gratuito",children:"Aluno com Gratuidade"}),e.jsx("option",{value:"aluno_pagante",children:"Aluno Pagante"}),e.jsx("option",{value:"idoso",children:"Idoso"})]}),e.jsxs("div",{className:"col-span-full",children:[C&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:C}),e.jsx("button",{className:"bg-green-700 hover:bg-green-800 text-white px-4 py-2 rounded",children:"‚ûï Criar Usu√°rio"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Usu√°rios Cadastrados"}),e.jsxs("div",{className:"flex gap-2 mt-2 md:mt-0",children:[e.jsx("button",{className:"border px-3 py-1 rounded hover:bg-gray-100",onClick:()=>_(s),children:"üìÑ PDF"}),e.jsx("button",{className:"border px-3 py-1 rounded hover:bg-gray-100",onClick:()=>A(s),children:"üìë CSV"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto border border-gray-200",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-4 py-2",children:"Nome"}),e.jsx("th",{className:"px-4 py-2",children:"E-mail"}),e.jsx("th",{className:"px-4 py-2",children:"CPF"}),e.jsx("th",{className:"px-4 py-2",children:"RG"}),e.jsx("th",{className:"px-4 py-2",children:"Perfil"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"A√ß√µes"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"Nenhum usu√°rio cadastrado"})}):s.map((r,n)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:r.nome}),e.jsx("td",{className:"px-4 py-2",children:r.email}),e.jsx("td",{className:"px-4 py-2",children:r.cpf}),e.jsx("td",{className:"px-4 py-2",children:r.rg}),e.jsx("td",{className:"px-4 py-2",children:r.perfil}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>R(n),className:"text-red-600 hover:underline",children:"Remover"})})]},r.id||n))})]})})]})]})};export{I as default};
