import{r as t,j as e,B as A,T as k,P as _,b as q,C as F}from"./index-B9Nf5u-5.js";import{C as L,r as O,B as W}from"./index-DVFSxR7X.js";import{a as C}from"./index-ngrFHoWO.js";import{T as i}from"./TextField-t-1AHP0N.js";import{M as s}from"./MenuItem-Kv2YlDX9.js";import"./dividerClasses-0nFLKQrh.js";L.register(...O);function z(){const[n,D]=t.useState(""),[l,I]=t.useState(""),[r,P]=t.useState(""),[c,E]=t.useState(""),[S,d]=t.useState([]),[p,u]=t.useState(null),[g,h]=t.useState(!1),b="https://api.seudominio.com/api",x=localStorage.getItem("token"),m=x?{Authorization:`Bearer ${x}`}:{};t.useEffect(()=>{C.get(`${b}/onibus`,{headers:m}).then(a=>d(Array.isArray(a.data)?a.data:[])).catch(a=>{d([]),console.error("‚ùå Erro ao carregar √¥nibus:",a)})},[]);const T=async()=>{if(!n||!l){alert("üìÜ Selecione o intervalo de datas.");return}h(!0),u(null);try{const a={dataInicio:n,dataFim:l,tipo:r,onibus_id:c},B=await C.get(`${b}/relatorios/embarques`,{params:a,headers:m}),o={};(B.data||[]).forEach(v=>{var j,y;if(r&&((j=v.passageiro)==null?void 0:j.subtipo_passageiro)!==r)return;const f=((y=v.passageiro)==null?void 0:y.subtipo_passageiro)||"Desconhecido";o[f]=(o[f]||0)+1}),u({labels:Object.keys(o),datasets:[{label:"Qtd. Embarques",data:Object.values(o),backgroundColor:"rgba(63, 81, 181, 0.7)",borderRadius:4}]})}catch(a){u(null),console.error("‚ùå Erro ao buscar embarques:",a),alert("Erro ao buscar dados. Verifique a API ou o filtro.")}finally{h(!1)}};return e.jsxs(A,{p:{xs:2,sm:4},children:[e.jsx(k,{variant:"h5",fontWeight:"bold",color:"green",gutterBottom:!0,children:"üìä Painel Visual Administrativo"}),e.jsxs(_,{sx:{p:2,mb:4,display:"flex",flexWrap:"wrap",gap:2},children:[e.jsx(i,{type:"date",label:"Data In√≠cio",value:n,onChange:a=>D(a.target.value),InputLabelProps:{shrink:!0}}),e.jsx(i,{type:"date",label:"Data Fim",value:l,onChange:a=>I(a.target.value),InputLabelProps:{shrink:!0}}),e.jsxs(i,{select:!0,label:"Tipo de Passageiro",value:r,onChange:a=>P(a.target.value),sx:{minWidth:180},children:[e.jsx(s,{value:"",children:"Todos"}),e.jsx(s,{value:"aluno_gratuito",children:"Aluno Gratuito"}),e.jsx(s,{value:"aluno_pagante",children:"Aluno Pagante"}),e.jsx(s,{value:"idoso",children:"Idoso"}),e.jsx(s,{value:"servidor_publico",children:"Servidor P√∫blico"}),e.jsx(s,{value:"passageiro",children:"Passageiro"})]}),e.jsxs(i,{select:!0,label:"√înibus",value:c,onChange:a=>E(a.target.value),sx:{minWidth:180},children:[e.jsx(s,{value:"",children:"Todos"}),S.map(a=>e.jsx(s,{value:a.id,children:a.placa},a.id))]}),e.jsx(q,{onClick:T,variant:"contained",sx:{height:56},children:"üîç Aplicar Filtros"})]}),g&&e.jsx(F,{}),!g&&p&&e.jsx(A,{sx:{width:"100%",height:400},children:e.jsx(W,{data:p,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Distribui√ß√£o de Embarques por Tipo"}},scales:{y:{beginAtZero:!0}}}})})]})}export{z as default};
