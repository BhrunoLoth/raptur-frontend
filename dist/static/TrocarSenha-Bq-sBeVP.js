import{u as x,r as i,j as e}from"./index-B9Nf5u-5.js";import{P as S}from"./PublicLayout-CMtIB1BJ.js";const v="https://api.seudominio.com/api";function w(){const s=x(),[t,h]=i.useState(""),[c,p]=i.useState(""),[l,o]=i.useState(""),[d,u]=i.useState(""),f=async r=>{if(r.preventDefault(),o(""),u(""),!t||t.length<6)return o("A nova senha deve ter pelo menos 6 caracteres.");if(t!==c)return o("As novas senhas não coincidem.");try{const n=localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("usuario"));if(!n||!(a!=null&&a.id))throw new Error("Sessão inválida.");const m=await fetch(`${v}/usuarios/trocar-senha`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({senha_nova:t})});if(!m.ok){const g=await m.json().catch(()=>({}));throw new Error(g.erro||"Erro ao trocar senha.")}a.precisaTrocarSenha=!1,localStorage.setItem("usuario",JSON.stringify(a)),u("Senha alterada com sucesso! Redirecionando..."),setTimeout(()=>{a.perfil==="passageiro"?s("/passageiro/dashboard"):a.perfil==="motorista"?s("/motorista/dashboard"):a.perfil==="admin"?s("/dashboard"):s("/")},2e3)}catch(n){o(n.message||"Erro ao trocar senha.")}};return e.jsx(S,{children:e.jsxs("div",{className:"max-w-md mx-auto mt-12 bg-white p-6 md:p-8 rounded-xl shadow",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold mb-6 text-center text-green-800",children:"🔐 Trocar Senha"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"password",placeholder:"Nova senha",value:t,onChange:r=>h(r.target.value),className:"w-full p-3 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500",required:!0,minLength:6}),e.jsx("input",{type:"password",placeholder:"Confirmar nova senha",value:c,onChange:r=>p(r.target.value),className:"w-full p-3 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-green-500",required:!0,minLength:6}),l&&e.jsx("p",{className:"text-red-600 text-sm text-center",children:l}),d&&e.jsx("p",{className:"text-green-600 text-sm text-center",children:d}),e.jsx("button",{type:"submit",className:"w-full bg-green-700 hover:bg-green-800 text-white py-2 rounded font-medium transition",children:"Salvar nova senha"})]})]})})}export{w as default};
