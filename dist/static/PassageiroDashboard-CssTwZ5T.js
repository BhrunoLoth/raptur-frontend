import{r,j as e}from"./index-B9Nf5u-5.js";import{Q as f}from"./index-Y5_mabEb.js";const v="https://api.seudominio.com/api";function E(){const[s,i]=r.useState(null),[g,h]=r.useState(!0),[d,c]=r.useState("");r.useEffect(()=>{(async()=>{try{const t=JSON.parse(localStorage.getItem("usuario")),x=localStorage.getItem("token");if(!(t!=null&&t.id)||!x)throw new Error("Token ou ID de usuário ausente.");const n=await fetch(`${v}/passageiros/${t.id}`,{headers:{Authorization:`Bearer ${x}`}});if(!n.ok){const b=await n.json().catch(()=>({}));throw new Error(b.erro||"Erro ao buscar dados do passageiro.")}const j=await n.json(),u={...t,...j};localStorage.setItem("usuario",JSON.stringify(u)),i(u),c("")}catch(t){c(t.message||"Erro ao carregar dados."),i(null),console.error("[Dashboard Passageiro] Erro:",t.message)}finally{h(!1)}})()},[]);const p=()=>{const o=document.getElementById("qrcode-canvas");if(!o)return;const t=document.createElement("a");t.download="qrcode-raptur.png",t.href=o.toDataURL("image/png"),t.click()};if(g)return e.jsx("p",{className:"text-center text-gray-500",children:"Carregando dados atualizados..."});if(d)return e.jsx("p",{className:"text-center text-red-600",children:d});if(!s)return e.jsx("p",{className:"text-center text-red-600",children:"Erro ao carregar dados."});const a=s.qrCode,l=a&&a.startsWith("http"),m=a&&a.startsWith("data:image/");return e.jsxs("div",{className:"max-w-2xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-md mt-6",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold mb-4 text-green-800 text-center",children:["Bem-vindo, ",s.nome]}),e.jsxs("div",{className:"mb-4 text-sm md:text-base",children:[e.jsx("strong",{children:"Tipo de passageiro:"})," ",s.tipo||s.subtipo_passageiro||"---"]}),e.jsxs("div",{className:"mb-4 text-sm md:text-base",children:[e.jsx("strong",{children:"Saldo:"})," ","R$ ",Number(s.saldo_credito??s.saldo??0).toFixed(2)]}),e.jsxs("div",{className:"text-sm md:text-base text-center mt-4",children:[e.jsx("strong",{children:"QR Code para embarque:"}),e.jsx("br",{}),a?e.jsxs(e.Fragment,{children:[l||m?e.jsx("img",{id:"qrcode-img",src:a,alt:"QR Code",className:"mt-4 mx-auto w-40 h-40 md:w-48 md:h-48"}):e.jsx(f,{id:"qrcode-canvas",value:a,size:180,level:"H",includeMargin:!0,style:{margin:"16px auto",display:"block"}}),!l&&!m&&e.jsx("button",{onClick:p,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Baixar QR Code"})]}):e.jsx("p",{className:"text-red-500 mt-2",children:"QR Code indisponível."})]})]})}export{E as default};
