import{r as o,j as e,B as T,T as u,b as p,P as I}from"./index-B9Nf5u-5.js";import{a as b}from"./index-ngrFHoWO.js";import{E as W}from"./jspdf.plugin.autotable-Bn4SibeE.js";import{C as $,a as L}from"./CardContent-Be5sf3AR.js";import{S as k}from"./Stack-GsMMUsNa.js";import{T as f}from"./TextField-t-1AHP0N.js";import{D as N}from"./Divider-DhoczBON.js";import{T as O,a as U,b as z,c as j,d as r,e as V}from"./TableRow-CpLTdYJq.js";import"./useThemeProps-g9lUOIHl.js";import"./dividerClasses-0nFLKQrh.js";const C="https://api.seudominio.com/api",ae=()=>{const[d,v]=o.useState(""),[m,g]=o.useState(""),[n,y]=o.useState(""),[l,S]=o.useState([]),[w,t]=o.useState(""),[E,P]=o.useState(!1),h={Authorization:`Bearer ${localStorage.getItem("token")}`},x=async()=>{try{const a=await b.get(`${C}/onibus`,{headers:h});S(Array.isArray(a.data)?a.data:[])}catch(a){t("Erro ao carregar ônibus."),console.error("Erro ao carregar ônibus:",a)}},B=async()=>{if(t(""),!d.trim()||d.length<6){t("Digite uma placa válida (mínimo 6 caracteres).");return}if(!m.trim()){t("Informe o modelo do ônibus.");return}if(!n||isNaN(n)||parseInt(n)<1){t("Capacidade deve ser um número inteiro positivo.");return}try{P(!0),await b.post(`${C}/onibus`,{placa:d.trim().toUpperCase(),modelo:m.trim(),capacidade:parseInt(n)},{headers:h}),v(""),g(""),y(""),await x()}catch{t("Erro ao criar ônibus. Placa pode já estar cadastrada.")}finally{P(!1)}},R=async a=>{if(window.confirm("Tem certeza que deseja remover este ônibus?"))try{await b.delete(`${C}/onibus/${a}`,{headers:h}),await x()}catch{t("Erro ao deletar ônibus.")}},D=()=>{const a=new W;a.text("Ônibus Cadastrados",14,16),a.autoTable({startY:22,head:[["Placa","Modelo","Capacidade"]],body:l.map(s=>[s.placa,s.modelo,s.capacidade])}),a.save("onibus.pdf")},F=()=>{const a=["Placa","Modelo","Capacidade"],s=l.map(c=>[c.placa,c.modelo,c.capacidade]),M=[a,...s].map(c=>c.join(",")).join(`
`),A=new Blob(["\uFEFF"+M],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(A),i.download="onibus.csv",document.body.appendChild(i),i.click(),document.body.removeChild(i)};return o.useEffect(()=>{x()},[]),e.jsxs(T,{p:4,children:[e.jsx(u,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"🚌 Gestão de Ônibus"}),e.jsx($,{sx:{mb:4,backgroundColor:"#f5f5f5",borderRadius:3},children:e.jsxs(L,{children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"Cadastrar Novo Ônibus"}),e.jsxs(k,{direction:{xs:"column",sm:"row"},spacing:2,children:[e.jsx(f,{label:"Placa",value:d,onChange:a=>v(a.target.value),fullWidth:!0,inputProps:{maxLength:8}}),e.jsx(f,{label:"Modelo",value:m,onChange:a=>g(a.target.value),fullWidth:!0}),e.jsx(f,{label:"Capacidade",type:"number",value:n,onChange:a=>y(a.target.value),fullWidth:!0,inputProps:{min:1}}),e.jsx(p,{variant:"contained",onClick:B,sx:{minWidth:"150px"},disabled:E,children:E?"Criando...":"Criar"})]}),w&&e.jsx(u,{mt:2,color:"error",children:w})]})}),e.jsx(N,{sx:{mb:3}}),e.jsxs(T,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(u,{variant:"h6",children:"🗂️ Ônibus Cadastrados"}),e.jsxs(k,{direction:"row",spacing:1,children:[e.jsx(p,{onClick:D,variant:"outlined",children:"📄 Exportar PDF"}),e.jsx(p,{onClick:F,variant:"outlined",children:"📑 Exportar CSV"})]})]}),e.jsx(O,{component:I,elevation:3,children:e.jsxs(U,{children:[e.jsx(z,{sx:{backgroundColor:"#004225"},children:e.jsxs(j,{children:[e.jsx(r,{sx:{color:"#fff"},children:"Placa"}),e.jsx(r,{sx:{color:"#fff"},children:"Modelo"}),e.jsx(r,{sx:{color:"#fff"},children:"Capacidade"}),e.jsx(r,{sx:{color:"#fff"},children:"Ações"})]})}),e.jsx(V,{children:l.length===0?e.jsx(j,{children:e.jsx(r,{colSpan:4,align:"center",children:"Nenhum ônibus cadastrado."})}):l.map(a=>e.jsxs(j,{children:[e.jsx(r,{children:a.placa}),e.jsx(r,{children:a.modelo}),e.jsx(r,{children:a.capacidade}),e.jsx(r,{children:e.jsx(p,{variant:"outlined",color:"error",size:"small",onClick:()=>R(a.id),children:"Remover"})})]},a.id))})]})})]})};export{ae as default};
