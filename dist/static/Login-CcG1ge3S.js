import{r as n,u as N,a as E,j as e}from"./index-B9Nf5u-5.js";import{P as k}from"./PublicLayout-CMtIB1BJ.js";import{l as C}from"./logo-raptur-BtDZxBYO.js";import{a as I}from"./api-DLJ_9syT.js";import"./index-ngrFHoWO.js";async function L(r,m){const{data:t}=await I.post("/auth/login",{email:r,senha:m});if(!(t!=null&&t.token)||!(t!=null&&t.usuario))throw new Error("Resposta de login inválida.");return localStorage.setItem("token",t.token),localStorage.setItem("usuario",JSON.stringify(t.usuario)),t.usuario}const J=()=>{const[r,m]=n.useState(""),[t,j]=n.useState(""),[u,o]=n.useState(""),[f,h]=n.useState(!1),l=n.useRef(null),c=N(),y=E();n.useEffect(()=>{const i=localStorage.getItem("token");try{const s=JSON.parse(localStorage.getItem("usuario")||"null");i&&(s!=null&&s.perfil)&&c({admin:"/admin/dashboard",motorista:"/motorista/dashboard",passageiro:"/passageiro/dashboard"}[s.perfil]||"/login",{replace:!0})}catch{}},[]);const v={admin:"/admin/dashboard",motorista:"/motorista/dashboard",passageiro:"/passageiro/dashboard"},w=async i=>{var s,d,x,b,S;if(i.preventDefault(),o(""),!r.trim()||!t.trim()){o("Preencha todos os campos."),(s=l.current)==null||s.focus();return}if(!/\S+@\S+\.\S+/.test(r)){o("Digite um e-mail válido."),(d=l.current)==null||d.focus();return}try{h(!0),localStorage.removeItem("token"),localStorage.removeItem("usuario");const a=await L(r,t);if(a!=null&&a.precisaTrocarSenha)return c("/trocar-senha",{replace:!0});const g=(b=(x=y.state)==null?void 0:x.from)==null?void 0:b.pathname;g&&g!=="/login"?c(g,{replace:!0}):c(v[a==null?void 0:a.perfil]||"/admin/dashboard",{replace:!0})}catch(a){typeof a=="string"?o(a):a!=null&&a.message?o(a.message):o("Erro ao fazer login. Verifique suas credenciais."),(S=l.current)==null||S.focus()}finally{h(!1)}},p=i=>s=>{i(s.target.value),u&&o("")};return e.jsx(k,{children:e.jsx("div",{className:"w-full min-h-screen flex items-center justify-center bg-gradient-to-br from-green-100 to-orange-100 p-4",children:e.jsxs("div",{className:"bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md",children:[e.jsx("img",{src:C,alt:"Logo Raptur",className:"w-24 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-center mb-6 text-green-800",children:"Acessar Painel"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium mb-1 text-gray-700",children:"Email"}),e.jsx("input",{id:"email",type:"email",placeholder:"Digite seu e-mail",className:"w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-green-400",value:r,onChange:p(m),ref:l,autoFocus:!0,autoComplete:"username"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"senha",className:"block text-sm font-medium mb-1 text-gray-700",children:"Senha"}),e.jsx("input",{id:"senha",type:"password",placeholder:"Digite sua senha",className:"w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-green-400",value:t,onChange:p(j),autoComplete:"current-password"})]}),u&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:u}),e.jsx("button",{type:"submit",className:"w-full bg-green-700 text-white py-2 rounded hover:bg-green-800 transition",disabled:f,children:f?"Entrando...":"Entrar"})]}),e.jsxs("p",{className:"mt-4 text-center text-sm text-gray-600",children:["Ainda não tem conta?"," ",e.jsx("a",{href:"/cadastro",className:"text-green-700 font-medium hover:underline",children:"Cadastre-se"})]})]})})})};export{J as default};
