import{a3 as x,r as o,j as e,u as M}from"./index-B9Nf5u-5.js";import{P as $,c as F}from"./idosoService-DSzU6Eut.js";import"./api-DLJ_9syT.js";import{A as R}from"./arrow-left-DNL3DQPg.js";import"./index-ngrFHoWO.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m14.31 8 5.74 9.94",key:"1y6ab4"}],["path",{d:"M9.69 8h11.48",key:"1wxppr"}],["path",{d:"m7.38 12 5.74-9.94",key:"1grp0k"}],["path",{d:"M9.69 16 3.95 6.06",key:"libnyf"}],["path",{d:"M14.31 16H2.83",key:"x5fava"}],["path",{d:"m16.62 12-5.74 9.94",key:"1vwawt"}]],z=x("aperture",S);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]],I=x("camera-off",_);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],P=x("camera",E);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],D=x("save",A);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],L=x("upload",H);function q({onCapture:u,onCancel:r}){const n=o.useRef(null),f=o.useRef(null),m=o.useRef(null),[h,g]=o.useState("");o.useEffect(()=>((async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}});m.current=t,n.current&&(n.current.srcObject=t)}catch(t){g("Erro ao acessar câmera. Verifique as permissões."),console.error(t)}})(),()=>{var t;(t=m.current)==null||t.getTracks().forEach(d=>d.stop()),m.current=null}),[]);const v=()=>{if(!n.current||!f.current)return;const t=f.current,d=n.current;t.width=d.videoWidth,t.height=d.videoHeight,t.getContext("2d").drawImage(d,0,0),t.toBlob(y=>{const i=new File([y],"foto-capturada.jpg",{type:"image/jpeg"});u==null||u(i,t.toDataURL("image/jpeg",.9))},"image/jpeg",.9)};return e.jsxs("div",{style:{padding:12,border:"1px solid #ddd",borderRadius:8},children:[h&&e.jsx("p",{style:{color:"red"},children:h}),e.jsx("video",{ref:n,autoPlay:!0,playsInline:!0,style:{width:"100%",borderRadius:6}}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsxs("button",{type:"button",onClick:v,style:{display:"flex",gap:6},children:[e.jsx(z,{size:16})," Capturar"]}),e.jsxs("button",{type:"button",onClick:r,style:{display:"flex",gap:6},children:[e.jsx(I,{size:16})," Fechar câmera"]})]}),e.jsx("canvas",{ref:f,style:{display:"none"}})]})}const T="https://api.seudominio.com/api";function G(){const u=M(),[r,n]=o.useState({nome:"",cpf:"",dataNascimento:""}),[f,m]=o.useState(null),[h,g]=o.useState(""),[v,t]=o.useState(!1),[d,j]=o.useState(!1),[y,i]=o.useState(""),b=p=>{const{name:s,value:c}=p.target;if(s==="cpf"){const a=c.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})/,"$1-$2").replace(/(-\d{2})\d+?$/,"$1");n(l=>({...l,cpf:a}))}else n(a=>({...a,[s]:c}));y&&i("")},w=p=>{var a;const s=(a=p.target.files)==null?void 0:a[0];if(!s)return;if(!s.type.startsWith("image/"))return i("Apenas imagens são permitidas.");if(s.size>5*1024*1024)return i("Arquivo muito grande (máx 5MB).");m(s);const c=new FileReader;c.onload=l=>g(l.target.result),c.readAsDataURL(s)},C=(p,s)=>{m(p),g(s),t(!1)},N=()=>r.nome.trim()?/^\d{3}\.\d{3}\.\d{3}-\d{2}$/.test(r.cpf)?r.dataNascimento?!0:(i("Data de nascimento é obrigatória"),!1):(i("CPF inválido"),!1):(i("Nome é obrigatório"),!1),k=async(p=!1)=>{var s,c;if(N())try{j(!0);const a=new FormData;a.append("nome",r.nome),a.append("cpf",r.cpf),a.append("dataNascimento",r.dataNascimento),f&&a.append("foto",f);const{idoso:l}=await F(a);if(!(l!=null&&l.id))throw new Error("Falha ao salvar");p&&window.open(`${T}/idosos/${l.id}/carteirinha.pdf`,"_blank","noopener"),u("/admin/idosos")}catch(a){console.error(a),i(((c=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:c.erro)||a.message||"Erro ao salvar")}finally{j(!1)}};return e.jsxs("div",{style:{padding:16,maxWidth:640},children:[e.jsxs("button",{className:"no-print",onClick:()=>u("/admin/idosos"),style:{display:"flex",gap:6},children:[e.jsx(R,{size:16})," Voltar"]}),e.jsx("h2",{style:{marginTop:12,marginBottom:12},children:"Cadastrar Idoso"}),y&&e.jsx("p",{style:{color:"red"},children:y}),e.jsxs("div",{style:{display:"grid",gap:12},children:[e.jsxs("label",{children:["Nome*",e.jsx("br",{}),e.jsx("input",{name:"nome",value:r.nome,onChange:b})]}),e.jsxs("label",{children:["CPF*",e.jsx("br",{}),e.jsx("input",{name:"cpf",value:r.cpf,onChange:b,placeholder:"000.000.000-00"})]}),e.jsxs("label",{children:["Data de Nascimento*",e.jsx("br",{}),e.jsx("input",{type:"date",name:"dataNascimento",value:r.dataNascimento,onChange:b})]}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",gap:6,alignItems:"center"},children:[e.jsx(L,{size:16}),e.jsx("input",{type:"file",accept:"image/*",onChange:w})]}),e.jsxs("button",{type:"button",onClick:()=>t(!0),style:{display:"flex",gap:6},children:[e.jsx(P,{size:16})," Tirar foto"]})]}),h&&e.jsx("img",{src:h,alt:"Prévia",style:{width:180,height:180,objectFit:"cover",borderRadius:8,border:"1px solid #ddd"}}),v&&e.jsx(q,{onCapture:C,onCancel:()=>t(!1)})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:16},children:[e.jsxs("button",{disabled:d,onClick:()=>k(!1),style:{display:"flex",gap:6},children:[e.jsx(D,{size:16})," Salvar"]}),e.jsxs("button",{disabled:d,onClick:()=>k(!0),style:{display:"flex",gap:6},children:[e.jsx($,{size:16})," Salvar & Imprimir"]})]})]})}export{G as default};
